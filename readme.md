# Telegram бот для помощи в реализации методики учёта собственной эффективности.

# Методика учета личной эффективности

-   Этот проект представляет собой реализацию методики учета личной эффективности, которая помогает отслеживать прогресс в выполнении задач, обучении, тренировках, настроении и других показателей в жизни.
-   Данная методика является реализацией идеи: "Нужно измерять если вы хотите эти управлять", или "Контролируется только то, что измеряется."
-   Методика основана на автоматизированном сборе данных из приложения Todoist либо заполнением значений показателей (метрик) через ручные команды боту и предоставлении аналитики через Telegram-бота.

## Описание методики

-   Методика учета личной эффективности — это подход, который позволяет отслеживать выполнение задач, анализировать количественные показатели и строить графики динамики. Это помогает понять, куда движется пользователь, и вносить изменения, если что-то идет не так.
-   Возможно использовать приложение Todoist для ежедневного планирования задач.

## Поддерживаемые показатели

-   Telegram-бот позволяет создавать следующие метрики:
    -   Количество выполненных задач в каждом проекте.
    -   Время, потраченное на задачу (проект), например на обучение минуты просмотренных обучающих видео, прослушанных аудио.
    -   Любая количественная метрика относящаяся к проекту, например количество прочитанных страниц обучающих книг или количество "помидоров" по Pomodoro.
    -   Любая количественная метрика в заранее созданном конфигурационном файле и заполняемая командой боту в одну строку.

## Отчёты

-   Бот по настроенному расписанию предоставляет графики в html:
    -   Суммарные показатели за день.
    -   Усредненные значения за неделю/месяц.
    -   Графики динамики для каждого показателя.
-   Также есть возможность:
    -   По расписанию получать письма на почту.
    -   По расписанию получать уведомления в telegram.

## Примеры показателей

-   Вот несколько примеров метрик, которые можно отслеживать:
    -   Проекты
        -   Количество выполненных задач в проекте.
            -   Число выполненных задач в проектах, Study, Health, Sport и т.д. за день.
    -   Количественные метрики внутри проекта.
        -   Количество прочитанных страниц обучающих книг в проекте Study.
        -   Количество минут медитации в проекте Health.
        -   Количество шагов или время физической активности в проекте Sport.
    -   Любой другой показатель, который отслеживается другими средствами.
        -   Состояние банковского счёта - периодическая отправка боту pdf с состоянием счётов, чтобы он мог запомнить значение и построить график изменения.
        -   Количество потраченных килокалорий за день.
        -   Субъективно оцениваемый показатель, например насколько у меня было хорошее настроение по 100 бальной шкале.

## Зачем это нужно?

-   Осознанность.
    -   Методика помогает понять, сколько времени и усилий тратится на каждую задачу, избегая иллюзии занятости.
-   Прогресс и мотивация.
    -   Графики динамики наглядно демонстрируют прогресс, что мотивирует двигаться дальше.
-   Контроль над временем
    -   Анализ данных помогает понять, как распределяется время, и перераспределить его на более важные задачи.
-   Гибкость.
    -   Методика может быть адаптирована под любые цели: достаточно перезаполнить файлы настроек.
-   Автоматизация.
    -   Автоматический сбор данных из Todoist экономит время.

## Как начать?

-   Разделите задачи по проектам (здоровье, обучение, личное развитие). Определите показатели (далее подробные примеры).
-   Настройте показатели внутри бота и расписание для ежедневной отправки графиков.
-   Установите и настройте Todoist. Необязательно, но с Todoist гораздо удобнее отслеживать проекты.
-   Подключите Telegram-бота к вашему аккаунту Todoist через API.

### Используется

-   aiogram 3.15.0
-   SQLAlchemy 2.0.36 + aiosqlite
-   todoist_api_python 2.1.7

# Первоначальная настройка приложения.

-   [Получить telegram token](https://gerabot.com/ru/article/yak_otrimati_token_telegram_ta_stvoriti_bota)
-   Чтобы начать работу с ботом зарегистрируйтесь командой `/register`:
-   Чтобы добавить функционал для взаимодействия с Todoist необходимо получить token вашего аккаунта Todoist ([вот тут сказано как](https://www.todoist.com/ru/help/articles/find-your-api-token-Jpzx9IIlB)). И добавить его с помощью команды: `/add_token длинная_строка_токена`. Если строка введена правильно, то ответом будет сообщение об успехе.

### Настройка базовых переменных.

-   Создайте файл `.env` в директории приложения и заполните значения:

```.env
DB_NAME="Имя файла базы данных sqlite", например: bot.db
BOT_TOKEN="Токен вашего телеграм бота"
SUPER_USER_TG_ID="Ваш телеграм ID" telegram_id администратора бота, если вы заполняете этот файл, то это вы
MAIL_SERVER_TOKEN="токен почтового сервера" если планируете пользоваться функционалом отправки email.
```

### Заполнение словаря настроек показателей.

В директории программы находится файл `settings/indicators.json` с содержанием показателей:

> [!info] Файл уже предварительно заполнен и для ознакомления с функционалом, тестирования, выбора собственных настроек и т.д. первое время можно пользоваться им.

```json
[
    {
        "indicator_name": "book",
        "project_name": "Study",
        "description_literal": "B",
        "calc_as_average": true,
        "project_track_based_method": true,
        "description_based_method": true,
        "quantity_based_method": false,
        "label_track_based_method": false,
        "task_name_track_based_method": false
    },
    {
        "indicator_name": "wealth_done",
        "project_name": "Wealth",
        "calc_as_average": true,
        "project_track_based_method": false,
        "description_based_method": false,
        "quantity_based_method": true,
        "label_track_based_method": false,
        "task_name_track_based_method": false
    },
    {
        "indicator_name": "steps",
        "project_name": "Health",
        "calc_as_average": true,
        "project_track_based_method": false,
        "description_based_method": false,
        "quantity_based_method": false,
        "label_track_based_method": false,
        "task_name_track_based_method": false
    },
    ...
]
```

-   Заполните файл своими показателями
    -   `indicator_name` - имя показателя, которое будет отражаться в отчётах и использоваться в командах.
    -   `project_name` - имя проекта Todoist, к которому привязан показатель
    -   `description_literal` - литерал описания Todoist с помощью, которого будет получаться численное значение показателя из описания задачи Todoist. Например, если в Todoist закрывается задача, а в её описании прописывается `B30`, то численное значение показателя book будет равно 30. Если показатель не участвует в такой расчётной методике, то этот параметр не устанавливается.
    -   `calc_as_average` - определяет будет ли показатель рассчитываться как среднее значение или будет участвовать в отчёте в своём абсолютном значении.
    -   `description_based_method` - параметр определяет применение метода расчёта значений показателя с помощью литералов.
    -   `project_track_based_method` - параметр определяет применение метода расчёта основанного на отслеживание прогресса по проекту(не реализовано в текущей версии, можно игнорировать).
    -   `quantity_based_method` - параметр определяет применениt количественного метода расчёта. Показатель будет равен количеству сделанного внутри проекта.
    -   `label_track_based_method` - параметр определяет применение метода расчёта значений показателя по значению в метке (label) задачи Todoist(не реализовано в текущей версии, можно игнорировать).
    -   `task_name_track_based_method` - параметр определяет применение метода расчёта значений показателя по конкретному имени задачи Todoist(не реализовано в текущей версии, можно игнорировать).
-   После заполнения файла с показателями нужно заполнить их в базу данных командой:`/add_indicators`. Если всё заполнено верно, то ответом придёт сообщение об успехе. Теперь ими можно пользоваться: заполнять в Todoist, обновлять в ручную и т.д.

### Настройки отчётов.

В файле `settings/report_config.py` заполните желаемые значения:

```python
# имена показателей в порядке который вы хотите в отчёте.
# если показателя не будет в списке, то в отчёт он не попадёт.
preferred_order = ["book",
                   "audiobook",
                   "video",
                   "cndx",
                   "cash",
                   "steps",
                   "kcals",
                   "poms",
                   "wealth_done",
                   "study_done",
                   "health_done",
                   "studio_done",
                   "social_done",
                   "add_income"]

# раскраска линий на графике
preferred_colors = {  # цвета линий на графике показателя
                        "book": "green",
                        "audiobook": "green",
                        "video": "green",
                        "study_done": "green",
                        "cndx": "red",
                        "cash": "red", "wealth_done": "red", "poms": "red", "add_income": "red",
                        "steps": "gold", "kcals": "gold", "health_done": "gold",
                        "studio_done": "blue",
                        "social_done": "cyan ",
                    }

# частота метки даты на оси X
date_label_freq = 25
```

-   в файле `config.py` поменяйте значение переменной `first_day_to_report` на желаемую дату отчёта дату

# Команды

#### обновление показателей по переданным значениям: команда /update. Вид команды:

```text
/update показатель1 значение1 показатель2 значение2 показатель3 значение3 ...
```

Например: `/update steps 5000 kcals 300` и т.д.

-   и т.д. Количество показателей ограничено только количеством символов, которые готов обработать телеграм.
-   Если не планируется использовать Todoist или ручных показателей довольно много, то я рекомендую создать шаблон строки в любом текстовом редакторе и после корректировки численных значений показателей отправлять боту.

#### Команда добавления \ обновления задач по расписанию: /taskadd.

> [!info] В случае если задача уже существует, то она будет обновлена.

-   Вид команды `/taskadd task_name task_type day_of_week hour minute task_param`, где
    -   `task_name` - имя задачи по расписанию (любое уникальное имя);
    -   `task_type` - тип задачи в виде специального символа, должен быть в одним из:
        `'r':  напоминание,  'g': ежедневный отчёт,  'm':  отправка почты`;
    -   `day_of_week` `hour` `minute` - параметры cron;
    -   `task_param` - параметры планируемой задачи:
        -   для напоминаний (символ `r`) - текст напоминания, в виде строки.
        -   для отправки почты (символ `m`) - `task_param` должен быть:
            1. `conf` означает, что параметры будут прочитаны из конфиг файла в директории `settings/mail_sender_config.py` В котором предварительно должны быть заполнены переменные:
            -   `receivers` - через запятую список email получателей;
            -   `files` - через запятую пути к файлам для отправки (если файл в корневой директории бота, то можно указать путь в виде `BaseDIR / Path('имя_файла')` );
        2. `json` означает, что параметры будут прочитаны из json файла корневой директории программы `sender.json` вида : (в данной версии не реализовано).
           `{"receivers": ["email_1", "email_2"], "files": ["путь_к_файлу_1", "путь_к_файлу_2"]}
        -   для ежедневного отчёта:
        3. `full` - будет отправлен полный отчёт.
        4. `имя показателя` - будет отправлен отчёт по одному показателю (в данной версии не реализовано)
-   При настройке задача дополнительно сохраняется в БД и при каждом перезапуске бота запланированные задачи перезапускаются.
-   Для просмотра настроек активных задач можно использовать команду `/tasksget` из меню бота.
-   Команда удаления задач по расписанию: `/task*del имя*задачи

#### Примеры команд по расписанию:

-   простое напоминание с именем simple_reminder каждый день в 9:10 с текстом "Простое напоминание":

```text
/taskadd simple_reminder r 0-6 9 10 Простое напоминание

```

-   Отправка письма согласно настройкам файла `settings/mail_sender_config.py` каждый день в 21:55

```text
/taskadd send_mail m 0-6 21 55 conf
```

-   Отправка ежедневного отчёта каждый день в 23:05

```text
/taskadd get_report g 0-6 23 5 full
```

#### Добавление показателя вручную команда: /create

```text
/create имя_показателя имя_проекта параметр_1 параметр_2 ...
```

-   на данный момент реализовано добавление показателей только для ручного обновления через `/update`.

## Команда запуска выгрузки и расчётов.

-   Если всё настроено правильно, то по команде `/go` будет выполнена выгрузка данных из Todoist, данные будут сохранены в БД приложения, будет выполнен расчёт показателей по заполненным настройкам и отправлен отчёт в виде сообщения и график в `.html` формате.

# Установка и запуск бота.

-   С помощью python:
    -   [Установить python 3.12.8](https://www.python.org/)
    -   [Установить git.](https://git-scm.com/book/ru/v2/%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-Git)
    -   `git clone https://github.com/MaximEkimenko/OwnBot.git` - клонирование проекта
    -   `cd OwnBot`
    -   `pip install -r requirements.txt` - установка зависимостей.
    -   `python main.py`

## Установка на устройстве android.

-   Для личного использования я запускал данного бота на мобильном устройстве android с помощью Termux. Показалось очень удобно: всегда с собой, быстро перезапустил, посмотрел логи; скопировал БД с показателями: сделал с ней, что хочешь, вернул на место и т.д.
-   Вот как это сделать:
    -   Установить termux на устройстве.
    -   Открыть доступ к файлам устройства для termux:

```bash
termux-setup-storage
```

-   копируем все файлы бота на устройство в доступную storage папку, например `movies`
-   копируем в корневую папку termux (предварительно создав их):

```bash
cp -r ~/storage/movies/ownbot/* ~/python/ownbot
```

-   ### 1. Создание скрипта запуска бота
-   Перейдите в домашнюю директорию Termux:

```bash
cd ~
```

-   Создайте новый файл, например startbot.sh:

```bash
nano startbot.sh
```

-   Добавьте в файл следующий код:

```bash
#!/bin/bash
# Перемещаемся в директорию с проектом
cd ~/python/ownbot
# Активируем виртуальное окружение
source venv/bin/activate
# Запускаем main.py
python main.py
# Деактивируем виртуальное окружение после завершения работы
deactivate
```

Сохраните файл, нажав CTRL + O, затем Enter, и выйдите из редактора, нажав CTRL + X.

-   Делаем скрипт исполняемым чтобы вы могли запускать этот скрипт, нужно дать ему права на выполнение:

```bash
chmod +x startbot.sh
```

-   Запуск скрипта
    Теперь вы можете запустить свой скрипт одной командой:

```bash
./startbot.sh
```

### 2. Автоматический запуск при старте Termux

Чтобы скрипт запускался сразу при открытии Termux:

-   Откройте файл ~/.bashrc:

```bash
nano ~/.bashrc
```

-   В конец файла добавьте строку:

```bash
~/bin/startbot.sh
```

Сохраните изменения. Теперь при запуске Termux будет автоматически запускаться ваш бот.

-   Также можно всё сделать через git, но для этого будет другая инструкция.

## TODO:

-   [ ] Добавить описание установки на устройство android c помощью git в readme.md.
-   [ ] Добавить тесты.
-   [ ] Добавить docker.
-   [ ] Мелкие TODO внутри проекта.
-   [ ] Использовать Webhook вместо polling.
-   [ ] Обработка метки @Achievement Todoist. Формирование специального отчёта (логика учёта достижений).
-   [ ] Добавление обработки xlsx файлов для получения значений показателей.
-   [ ] Обновить readme.md.
